# Threads in Concurrent Programming

## Thread Basics

* A **thread** is a logical flow of execution within a process.
* Each thread has:

  * **Thread ID (TID)**
  * Its own stack, stack pointer, program counter, registers, and condition codes
* All threads in a process share the **same virtual address space** (code, heap, shared libraries, open files).
* Threads are scheduled automatically by the OS kernel, making them lighter and faster to context-switch than processes.

---

## POSIX Threads (Pthreads)

* Standard API for creating and managing threads in C programs.
* Common operations:

  * `pthread_create`: create a new thread.
  * `pthread_self`: get thread’s own ID.
  * `pthread_exit`: terminate current thread.
  * `pthread_cancel`: kill a peer thread.
  * `pthread_join`: wait for another thread to finish (reap it).
  * `pthread_detach`: mark a thread as detached.

---

## Thread Lifecycle

* A thread ends when:

  * Its routine returns.
  * It explicitly calls `pthread_exit`.
  * Another peer calls `pthread_cancel`.
  * The entire process exits.
* Terminated threads still consume memory until they’re either:

  * **Reaped** (via `pthread_join`), or
  * **Detached** (via `pthread_detach`).

---

## Joinable vs Detached Threads

### Joinable Threads

* Default state when threads are created.
* Must be explicitly **joined** by another thread.
* Memory (stack, resources) is not freed until `pthread_join` is called.
* Useful when:

  * Results need to be collected from a thread.
  * Synchronisation is required (ensures thread has finished before continuing).
* Risk: if never joined, causes a **resource leak**.

### Detached Threads

* Cannot be joined by other threads.
* Automatically cleaned up by the system when they terminate.
* Good for "fire-and-forget" tasks (e.g., handling independent client requests).
* Risk: no way to check if they finished successfully, harder to synchronise.

---

## Example Use Cases

* **Joinable**:

  * Calculating results in worker threads where the main thread needs the output.
  * Long-running jobs where completion matters.
* **Detached**:

  * Web server creating a thread for each client connection; no need to wait for each one.
  * Background tasks that simply run and finish on their own.

---

## Initialising Once

* `pthread_once`: Ensures an initialisation routine is run only once, even across multiple threads.
  Useful for setting up global/shared state safely.

---

# Questions of the Day

### 1. Why might a programmer choose joinable threads over detached?

* To collect **results** or ensure **orderly cleanup**.
* Prevents resource leaks by explicitly reaping memory.
* Provides synchronisation, ensuring dependent tasks don’t proceed prematurely.

### 2. How does understanding the difference prevent issues?

* Avoids **memory leaks** (joinable threads left unreaped).
* Avoids **race conditions** by choosing synchronisation properly.
* Prevents **dangling threads** where the main program exits before a detached worker finishes.