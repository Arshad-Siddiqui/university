# Low-Level Debugging and Security Using GDB

## GDB Basics

* **GDB (GNU Debugger)**: A tool for tracing and controlling program execution at the machine level.
* Lets you:

  * Set **breakpoints** (pause execution at chosen points).
  * **Inspect registers and memory**.
  * **Step through** program instructions one at a time.
* Useful for understanding how high-level C code maps to assembly and how the program behaves at runtime.

---

## Out-of-Bounds Memory References

* **C does not check array bounds**.
* Local variables (including arrays) are stored on the **stack**, alongside:

  * Saved register values
  * Return addresses
* If a write goes beyond allocated space, it can **corrupt stack state**.
* Corruption may lead to:

  * Incorrect register values restored
  * Return instruction (`ret`) jumping to unintended locations
  * Crashes or erratic behavior

---

## Buffer Overflow

* A **buffer overflow** happens when data written to an array exceeds its allocated space.
* Example: using `gets()` to read input into a small buffer.

  * If the buffer is 8 bytes but user enters a longer string, excess bytes overwrite return address or saved registers.
* Exploitation:

  * Attackers can craft input containing **malicious code** (exploit payload) plus a new **return address** pointing to it.
  * When function returns, program jumps to attacker’s code.
* Real-world case: **1988 Internet Worm** used buffer overflow in the `finger` daemon to spread across systems.

---

## Debugging Example

* Program with `echo()` and `gets()` allocates too little stack space for input.
* Using GDB, one can:

  * Set breakpoints inside `echo()`.
  * Watch how input characters overwrite stack memory step by step.
  * Observe how saved return addresses or registers get corrupted.

---

## Defense Mechanisms

1. **Stack Randomization (ASLR)**

   * Varies memory addresses on each run.
   * Makes it harder for attackers to predict buffer locations.
   * Partial protection: brute force + "nop sleds" can bypass it.

2. **Stack Canaries (Stack Protector)**

   * Compiler inserts a random value (canary) before sensitive stack state.
   * If overflow overwrites the canary, program detects corruption and aborts.
   * Prevents silent exploitation.

---

## Worms vs Viruses (sidebar)

* **Worm**: Self-contained program that replicates across systems.
* **Virus**: Injects itself into other programs but cannot run alone.
* Press/media often misuse “virus” for both.

---

## Why This Matters

* **Debugging**: Tools like GDB help trace and fix subtle memory errors.
* **Security**: Understanding buffer overflows shows why unsafe functions (`gets`, `strcpy`, `sprintf`) are dangerous.
* **Prevention**: Writing secure code means avoiding unchecked memory writes, validating input, and using safer library calls (`fgets`, `strncpy`).
* **Consequences**: If unaddressed, vulnerabilities can lead to system compromise, denial of service, or data theft.

---

✅ **Answers to Task Questions**:

1. **How GDB helps**: It makes memory layout visible, shows corruption when it happens, and lets you step instruction by instruction to pinpoint the cause of errors.
2. **Example**: In the `echo()` program, entering >7 chars shows in GDB how the return address gets corrupted — something invisible in C code.
3. **Why important**: Low-level issues like buffer overflows are a major vector for attacks. Understanding them is critical to writing safe, robust software.